# Replace with your actual domain.  Caddy provisions a Let's Encrypt
# certificate automatically on first startup â€” no extra configuration needed.
# Set DOMAIN in your environment (or in a .env file next to docker-compose.yml).
# Example: DOMAIN=example.com
{$DOMAIN:localhost} {

    reverse_proxy md-server:3000

    # Cache fingerprinted static assets aggressively.
    @static path *.css *.js *.png *.jpg *.jpeg *.gif *.svg *.webp *.pdf *.mp4
    header @static Cache-Control "public, max-age=86400, immutable"

    # Security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options    "nosniff"
        X-Frame-Options           "DENY"
        Referrer-Policy           "strict-origin-when-cross-origin"
        Permissions-Policy        "geolocation=(), camera=(), microphone=()"
        # Remove Caddy's Server header
        -Server
    }

    encode gzip

    log {
        output file /data/access.log {
            roll_size    100MiB
            roll_keep    5
            roll_keep_for 720h
        }
        format json
    }
}
